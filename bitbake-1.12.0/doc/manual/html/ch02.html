<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Chapter 2. Metadata</title><link rel="stylesheet" href="docbook.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="index.html" title="BitBake User Manual"><link rel="up" href="index.html" title="BitBake User Manual"><link rel="prev" href="ch01s02.html" title="Background and Goals"><link rel="next" href="ch02s02.html" title="Dependency Handling"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 2. Metadata</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch01s02.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ch02s02.html">Next</a></td></tr></table><hr></div><div class="chapter" title="Chapter 2. Metadata"><div class="titlepage"><div><div><h2 class="title"><a name="id2607131"></a>Chapter 2. Metadata</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="ch02.html#id2607136">Description</a></span></dt><dd><dl><dt><span class="section"><a href="ch02.html#id2607392">Basic variable setting</a></span></dt><dt><span class="section"><a href="ch02.html#id2607418">Variable expansion</a></span></dt><dt><span class="section"><a href="ch02.html#id2607466">Setting a default value (?=)</a></span></dt><dt><span class="section"><a href="ch02.html#id2607505">Setting a default value (??=)</a></span></dt><dt><span class="section"><a href="ch02.html#id2606761">Immediate variable expansion (:=)</a></span></dt><dt><span class="section"><a href="ch02.html#id2606831">Appending (+=) and prepending (=+)</a></span></dt><dt><span class="section"><a href="ch02.html#id2606879">Appending (.=) and prepending (=.) without spaces</a></span></dt><dt><span class="section"><a href="ch02.html#id2606930">Conditional metadata set</a></span></dt><dt><span class="section"><a href="ch02.html#id2606998">Conditional appending</a></span></dt><dt><span class="section"><a href="ch02.html#id2607655">Inclusion</a></span></dt><dt><span class="section"><a href="ch02.html#id2607689">Requiring Inclusion</a></span></dt><dt><span class="section"><a href="ch02.html#id2607720">Python variable expansion</a></span></dt><dt><span class="section"><a href="ch02.html#id2607743">Defining executable metadata</a></span></dt><dt><span class="section"><a href="ch02.html#id2607782">Defining python functions into the global python namespace</a></span></dt><dt><span class="section"><a href="ch02.html#id2607825">Variable Flags</a></span></dt><dt><span class="section"><a href="ch02.html#id2607869">Inheritance</a></span></dt><dt><span class="section"><a href="ch02.html#id2607902">Tasks</a></span></dt><dt><span class="section"><a href="ch02.html#id2607948">Events</a></span></dt><dt><span class="section"><a href="ch02.html#id2608004">Variants</a></span></dt></dl></dd><dt><span class="section"><a href="ch02s02.html">Dependency Handling</a></span></dt><dd><dl><dt><span class="section"><a href="ch02s02.html#id2658309">Dependencies internal to the .bb file</a></span></dt><dt><span class="section"><a href="ch02s02.html#id2658322">DEPENDS</a></span></dt><dt><span class="section"><a href="ch02s02.html#id2658348">RDEPENDS</a></span></dt><dt><span class="section"><a href="ch02s02.html#id2658373">Recursive DEPENDS</a></span></dt><dt><span class="section"><a href="ch02s02.html#id2658388">Recursive RDEPENDS</a></span></dt><dt><span class="section"><a href="ch02s02.html#id2658403">Inter Task</a></span></dt></dl></dd><dt><span class="section"><a href="ch02s03.html">Parsing</a></span></dt><dd><dl><dt><span class="section"><a href="ch02s03.html#id2658435">Configuration Files</a></span></dt><dt><span class="section"><a href="ch02s03.html#id2658471">Classes</a></span></dt><dt><span class="section"><a href="ch02s03.html#id2658493">.bb Files</a></span></dt></dl></dd></dl></div><div class="section" title="Description"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2607136"></a>Description</h2></div></div></div><div class="itemizedlist"><p>BitBake metadata can be classified into 3 major areas:</p><ul class="itemizedlist" type="disc"><li class="listitem"><p>Configuration Files</p></li><li class="listitem"><p>.bb Files</p></li><li class="listitem"><p>Classes</p></li></ul></div><p>What follows are a large number of examples of BitBake metadata.  Any syntax which isn't supported in any of the aforementioned areas will be documented as such.</p><div class="section" title="Basic variable setting"><div class="titlepage"><div><div><h3 class="title"><a name="id2607392"></a>Basic variable setting</h3></div></div></div><pre class="screen"><code class="varname">VARIABLE</code> = "value"</pre><p>In this example, <code class="varname">VARIABLE</code> is <code class="literal">value</code>.</p></div><div class="section" title="Variable expansion"><div class="titlepage"><div><div><h3 class="title"><a name="id2607418"></a>Variable expansion</h3></div></div></div><p>BitBake supports variables referencing one another's contents using a syntax which is similar to shell scripting</p><pre class="screen"><code class="varname">A</code> = "aval"
<code class="varname">B</code> = "pre${A}post"</pre><p>This results in <code class="varname">A</code> containing <code class="literal">aval</code> and <code class="varname">B</code> containing <code class="literal">preavalpost</code>.</p></div><div class="section" title="Setting a default value (?=)"><div class="titlepage"><div><div><h3 class="title"><a name="id2607466"></a>Setting a default value (?=)</h3></div></div></div><pre class="screen"><code class="varname">A</code> ?= "aval"</pre><p>If <code class="varname">A</code> is set before the above is called, it will retain it's previous value. If <code class="varname">A</code> is unset prior to the above call, <code class="varname">A</code> will be set to <code class="literal">aval</code>.  Note that this assignment is immediate, so if there are multiple ?= assignments to a single variable, the first of those will be used.</p></div><div class="section" title="Setting a default value (??=)"><div class="titlepage"><div><div><h3 class="title"><a name="id2607505"></a>Setting a default value (??=)</h3></div></div></div><pre class="screen"><code class="varname">A</code> ??= "somevalue"</pre><pre class="screen"><code class="varname">A</code> ??= "someothervalue"</pre><p>If <code class="varname">A</code> is set before the above, it will retain that value.  If <code class="varname">A</code> is unset prior to the above, <code class="varname">A</code> will be set to <code class="literal">someothervalue</code>.  This is a lazy version of ??=, in that the assignment does not occur until the end of the parsing process, so that the last, rather than the first, ??= assignment to a given variable will be used.</p></div><div class="section" title="Immediate variable expansion (:=)"><div class="titlepage"><div><div><h3 class="title"><a name="id2606761"></a>Immediate variable expansion (:=)</h3></div></div></div><p>:= results in a variable's contents being expanded immediately, rather than when the variable is actually used.</p><pre class="screen"><code class="varname">T</code> = "123"
<code class="varname">A</code> := "${B} ${A} test ${T}"
<code class="varname">T</code> = "456"
<code class="varname">B</code> = "${T} bval"

<code class="varname">C</code> = "cval"
<code class="varname">C</code> := "${C}append"</pre><p>In that example, <code class="varname">A</code> would contain <code class="literal"> test 123</code>, <code class="varname">B</code> would contain <code class="literal">456 bval</code>, and <code class="varname">C</code> would be <code class="literal">cvalappend</code>.</p></div><div class="section" title="Appending (+=) and prepending (=+)"><div class="titlepage"><div><div><h3 class="title"><a name="id2606831"></a>Appending (+=) and prepending (=+)</h3></div></div></div><pre class="screen"><code class="varname">B</code> = "bval"
<code class="varname">B</code> += "additionaldata"
<code class="varname">C</code> = "cval"
<code class="varname">C</code> =+ "test"</pre><p>In this example, <code class="varname">B</code> is now <code class="literal">bval additionaldata</code> and <code class="varname">C</code> is <code class="literal">test cval</code>.</p></div><div class="section" title="Appending (.=) and prepending (=.) without spaces"><div class="titlepage"><div><div><h3 class="title"><a name="id2606879"></a>Appending (.=) and prepending (=.) without spaces</h3></div></div></div><pre class="screen"><code class="varname">B</code> = "bval"
<code class="varname">B</code> .= "additionaldata"
<code class="varname">C</code> = "cval"
<code class="varname">C</code> =. "test"</pre><p>In this example, <code class="varname">B</code> is now <code class="literal">bvaladditionaldata</code> and <code class="varname">C</code> is <code class="literal">testcval</code>. In contrast to the above Appending and Prepending operators no additional space
will be introduced.</p></div><div class="section" title="Conditional metadata set"><div class="titlepage"><div><div><h3 class="title"><a name="id2606930"></a>Conditional metadata set</h3></div></div></div><p>OVERRIDES is a <span class="quote">&#8220;<span class="quote">:</span>&#8221;</span> separated variable containing each item you want to satisfy conditions.  So, if you have a variable which is conditional on <span class="quote">&#8220;<span class="quote">arm</span>&#8221;</span>, and <span class="quote">&#8220;<span class="quote">arm</span>&#8221;</span> is in OVERRIDES, then the <span class="quote">&#8220;<span class="quote">arm</span>&#8221;</span> specific version of the variable is used rather than the non-conditional version.  Example:</p><pre class="screen"><code class="varname">OVERRIDES</code> = "architecture:os:machine"
<code class="varname">TEST</code> = "defaultvalue"
<code class="varname">TEST_os</code> = "osspecificvalue"
<code class="varname">TEST_condnotinoverrides</code> = "othercondvalue"</pre><p>In this example, <code class="varname">TEST</code> would be <code class="literal">osspecificvalue</code>, due to the condition <span class="quote">&#8220;<span class="quote">os</span>&#8221;</span> being in <code class="varname">OVERRIDES</code>.</p></div><div class="section" title="Conditional appending"><div class="titlepage"><div><div><h3 class="title"><a name="id2606998"></a>Conditional appending</h3></div></div></div><p>BitBake also supports appending and prepending to variables based on whether something is in OVERRIDES.  Example:</p><pre class="screen"><code class="varname">DEPENDS</code> = "glibc ncurses"
<code class="varname">OVERRIDES</code> = "machine:local"
<code class="varname">DEPENDS_append_machine</code> = " libmad"</pre><p>In this example, <code class="varname">DEPENDS</code> is set to <code class="literal">glibc ncurses libmad</code>.</p></div><div class="section" title="Inclusion"><div class="titlepage"><div><div><h3 class="title"><a name="id2607655"></a>Inclusion</h3></div></div></div><p>Next, there is the <code class="literal">include</code> directive, which causes BitBake to parse in whatever file you specify, and insert it at that location, which is not unlike <span class="command"><strong>make</strong></span>.  However, if the path specified on the <code class="literal">include</code> line is a relative path, BitBake will locate the first one it can find within <code class="envar">BBPATH</code>.</p></div><div class="section" title="Requiring Inclusion"><div class="titlepage"><div><div><h3 class="title"><a name="id2607689"></a>Requiring Inclusion</h3></div></div></div><p>In contrast to the <code class="literal">include</code> directive, <code class="literal">require</code> will
raise an ParseError if the to be included file can not be found. Otherwise it will behave just like the <code class="literal">
include</code> directive.</p></div><div class="section" title="Python variable expansion"><div class="titlepage"><div><div><h3 class="title"><a name="id2607720"></a>Python variable expansion</h3></div></div></div><pre class="screen"><code class="varname">DATE</code> = "${@time.strftime('%Y%m%d',time.gmtime())}"</pre><p>This would result in the <code class="varname">DATE</code> variable containing today's date.</p></div><div class="section" title="Defining executable metadata"><div class="titlepage"><div><div><h3 class="title"><a name="id2607743"></a>Defining executable metadata</h3></div></div></div><p><span class="emphasis"><em>NOTE:</em></span> This is only supported in .bb and .bbclass files.</p><pre class="screen">do_mytask () {
    echo "Hello, world!"
}</pre><p>This is essentially identical to setting a variable, except that this variable happens to be executable shell code.</p><pre class="screen">python do_printdate () {
    import time
    print time.strftime('%Y%m%d', time.gmtime())
}</pre><p>This is the similar to the previous, but flags it as python so that BitBake knows it is python code.</p></div><div class="section" title="Defining python functions into the global python namespace"><div class="titlepage"><div><div><h3 class="title"><a name="id2607782"></a>Defining python functions into the global python namespace</h3></div></div></div><p><span class="emphasis"><em>NOTE:</em></span> This is only supported in .bb and .bbclass files.</p><pre class="screen">def get_depends(bb, d):
    if bb.data.getVar('SOMECONDITION', d, True):
        return "dependencywithcond"
    else:
        return "dependency"

<code class="varname">SOMECONDITION</code> = "1"
<code class="varname">DEPENDS</code> = "${@get_depends(bb, d)}"</pre><p>This would result in <code class="varname">DEPENDS</code> containing <code class="literal">dependencywithcond</code>.</p></div><div class="section" title="Variable Flags"><div class="titlepage"><div><div><h3 class="title"><a name="id2607825"></a>Variable Flags</h3></div></div></div><p>Variables can have associated flags which provide a way of tagging extra information onto a variable. Several flags are used internally by bitbake but they can be used externally too if needed. The standard operations mentioned above also work on flags.</p><pre class="screen"><code class="varname">VARIABLE</code>[<code class="varname">SOMEFLAG</code>] = "value"</pre><p>In this example, <code class="varname">VARIABLE</code> has a flag, <code class="varname">SOMEFLAG</code> which is set to <code class="literal">value</code>.</p></div><div class="section" title="Inheritance"><div class="titlepage"><div><div><h3 class="title"><a name="id2607869"></a>Inheritance</h3></div></div></div><p><span class="emphasis"><em>NOTE:</em></span> This is only supported in .bb and .bbclass files.</p><p>The <code class="literal">inherit</code> directive is a means of specifying what classes of functionality your .bb requires.  It is a rudimentary form of inheritance.  For example, you can easily abstract out the tasks involved in building a package that uses autoconf and automake, and put that into a bbclass for your packages to make use of.  A given bbclass is located by searching for classes/filename.oeclass in <code class="envar">BBPATH</code>, where filename is what you inherited.</p></div><div class="section" title="Tasks"><div class="titlepage"><div><div><h3 class="title"><a name="id2607902"></a>Tasks</h3></div></div></div><p><span class="emphasis"><em>NOTE:</em></span> This is only supported in .bb and .bbclass files.</p><p>In BitBake, each step that needs to be run for a given .bb is known as a task.  There is a command <code class="literal">addtask</code> to add new tasks (must be a defined python executable metadata and must start with <span class="quote">&#8220;<span class="quote">do_</span>&#8221;</span>) and describe intertask dependencies.</p><pre class="screen">python do_printdate () {
    import time
    print time.strftime('%Y%m%d', time.gmtime())
}

addtask printdate before do_build</pre><p>This defines the necessary python function and adds it as a task which is now a dependency of do_build (the default task).  If anyone executes the do_build task, that will result in do_printdate being run first.</p></div><div class="section" title="Events"><div class="titlepage"><div><div><h3 class="title"><a name="id2607948"></a>Events</h3></div></div></div><p><span class="emphasis"><em>NOTE:</em></span> This is only supported in .bb and .bbclass files.</p><p>BitBake allows to install event handlers.  Events are triggered at certain points during operation, such as, the beginning of operation against a given .bb, the start of a given task, task failure, task success, et cetera.  The intent was to make it easy to do things like email notifications on build failure.</p><pre class="screen">addhandler myclass_eventhandler
python myclass_eventhandler() {
    from bb.event import getName
    from bb import data

    print("The name of the Event is %s" % getName(e))
    print("The file we run for is %s" % data.getVar('FILE', e.data, True))
}
</pre><p>
This event handler gets called every time an event is triggered. A global variable <code class="varname">e</code> is defined. <code class="varname">e</code>.data contains an instance of bb.data. With the getName(<code class="varname">e</code>)
method one can get the name of the triggered event.</p><p>The above event handler prints the name
of the event and the content of the <code class="varname">FILE</code> variable.</p></div><div class="section" title="Variants"><div class="titlepage"><div><div><h3 class="title"><a name="id2608004"></a>Variants</h3></div></div></div><p>Two Bitbake features exist to facilitate the creation of multiple buildable incarnations from a single recipe file.</p><p>The first is <code class="varname">BBCLASSEXTEND</code>.  This variable is a space separated list of classes to utilize to "extend" the recipe for each variant.  As an example, setting </p><pre class="screen">BBCLASSEXTEND = "native"</pre><p> results in a second incarnation of the current recipe being available.  This second incarantion will have the "native" class inherited.</p><p>The second feature is <code class="varname">BBVERSIONS</code>.  This variable allows a single recipe to be able to build multiple versions of a project from a single recipe file, and allows you to specify conditional metadata (using the <code class="varname">OVERRIDES</code> mechanism) for a single version, or an optionally named range of versions:</p><pre class="screen">BBVERSIONS = "1.0 2.0 git"
SRC_URI_git = "git://someurl/somepath.git"</pre><pre class="screen">BBVERSIONS = "1.0.[0-6]:1.0.0+ \
              1.0.[7-9]:1.0.7+"
SRC_URI_append_1.0.7+ = "file://some_patch_which_the_new_versions_need.patch;patch=1"</pre><p>Note that the name of the range will default to the original version of the recipe, so given OE, a recipe file of foo_1.0.0+.bb will default the name of its versions to 1.0.0+.  This is useful, as the range name is not only placed into overrides, it's also made available for the metadata to use in the form of the <code class="varname">BPV</code> variable, for use in file:// search paths (<code class="varname">FILESPATH</code>).</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch01s02.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ch02s02.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Background and Goals </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Dependency Handling</td></tr></table></div></body></html>
